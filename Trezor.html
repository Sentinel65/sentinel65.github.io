<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hra Trezor</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Arial, sans-serif;
    }
    #gameContainer {
      display: grid;
      grid-template-areas: 
        "letters letters letters"
        "left board right"
        "bottom bottom bottom"
        "skimmers skimmers skimmers";
      gap: 5px;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-gap: 5px;
      justify-content: center;
      margin: 10px;
      grid-area: board;
    }
    .cell {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #000;
      font-size: 14px;
      cursor: pointer;
      user-select: none;
    }
    .cell.clicked { background-color: #4B4C4B; color: #fff;cursor: not-allowed;pointer-events: none;} /* Styl oznaÄenÃ½ch polÃ­Äek */
    .disabled { background-color: #000; cursor: default; } /* NehratelnÃ¡ polÃ­Äka */
    .used { background-color: #d3d3d3; cursor: default; color: #333; } /* Styl pouÅ¾itÃ½ch kostek */
    .odd { background-color: #e0ffe0; } /* LichÃ¡ ÄÃ­sla */
    .even { background-color: #e0e0ff; } /* SudÃ¡ ÄÃ­sla */
    .double { background-color: #ffe0e0; } /* Double */
    #letters, #left, #right, #bottom {
      display: grid;
      font-weight: bold;
      font-size: 16px;
      text-align: center;
    }
    #letters {
      grid-template-columns: repeat(7, 1fr);
      grid-area: letters;
	  margin-right: 30px;
    }
    #left {
      grid-template-rows: repeat(6, 1fr);
      grid-area: left;
      justify-content: end;
      margin-top: 23px;
    }
    #right {
      grid-template-rows: repeat(6, 1fr);
      grid-area: right;
      margin-top: 20px;
    }
    #bottom {
      grid-template-columns: repeat(7, 1fr);
      grid-area: bottom;
	  margin-right: 18px;
    }
    #skimmers {
      grid-area: skimmers;
      display: flex;
      justify-content: center;
      gap: 20px;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
    }
    .lock {
      color: black;
    }
    .score {
    font-size: 14px;
    font-weight: bold;
    }
    .highscore {
    font-size: 14px;
    font-weight: bold;
    }
    .skimmer {
      padding: 5px 10px;
      border: 2px solid #333;
      border-radius: 5px;
      cursor: pointer;
      user-select: none;
    }
    .skimmer.clicked { background-color: #90cfff; } /* Styl oznaÄenÃ½ch skimmerÅ¯ */
    #diceContainer {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .skimmer.disabled {
	  background-color: #d3d3d3;
	  color: #888;
	  cursor: not-allowed;
	  pointer-events: none;
	  border-color: #888;
	}
    
      /* StylovÃ¡nÃ­ pro tlaÄÃ­tka nÃ¡povÄ›dy  */
	  .help-button {
		padding: 5px 10px;
		border: 2px solid #333;
		border-radius: 5px;
		cursor: pointer;
		color: white;
		background-color: #4B4C4B;
		font-size: 20px;
		font-weight: bold;
		user-select: none;
	 }
    
      /* StylovÃ¡nÃ­ pro tlaÄÃ­tka ReRoll */
	  .reroll-button {
		padding: 5px 10px;
		border: 2px solid #333;
		border-radius: 5px;
		cursor: pointer;
		background-color: #90cfff;
		font-size: 14px;
		font-weight: bold;
		user-select: none;
	 }

	  /* Styl pro deaktivovanÃ¡ tlaÄÃ­tka */
	  .reroll-button.disabled {
		background-color: #d3d3d3;
		color: #888;
		cursor: not-allowed;
	    pointer-events: none;
		border-color: #888;
	 }
	   .highlight {
	  background-color: lightgreen;
	  color: black;
	  font-weight: bold;
	} 
	  .highlight-empty {
	  background-color: yellow;
	  color: black;
	  font-weight: bold;
	}

	  .highlight-filled {
	  background-color: #4B4C4B;
	  color: yellow;
	  font-weight: bold;
	}
			.die {
		  width: 40px;
		  height: 40px;
		  display: flex;
		  align-items: center;
		  justify-content: center;
		  border: 2px solid #333;
		  border-radius: 5px;
		  font-size: 18px;
		  font-weight: bold;
		  cursor: pointer;
		  user-select: none;
		  transition: transform 0.3s;
		}
    .die.clicked { background-color: #90cfff; } /* Styl oznaÄenÃ½ch kostek */
    #rollButton {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

.die.rolling {
    animation: roll 0.5s ease-in-out;
}

@keyframes roll {
    0% { transform: rotate(0deg); }
    25% { transform: rotate(90deg); }
    50% { transform: rotate(180deg); }
    75% { transform: rotate(270deg); }
    100% { transform: rotate(360deg); }
}
    @media (max-width: 600px) {
      .cell, .die {
        width: 30px;
        height: 30px;
        font-size: 12px;
      }
      #letters, #left, #right, #bottom, #skimmers {
        font-size: 14px;
      }
      .skimmer { padding: 5px; }
    }

	 
	/* ZÃ¡kladnÃ­ styl pro modÃ¡lnÃ­ okno */
    .modal {
    display: none; /* SkrytÃ© ve vÃ½chozÃ­m stavu */
    position: fixed; /* ZÅ¯stane na jednom mÃ­stÄ› i pÅ™i skrolovÃ¡nÃ­ */
    z-index: 1; /* ZajiÅ¡tÄ›nÃ­, Å¾e bude nad ostatnÃ­m obsahem */
    padding-top: 60px;
    left: 0;
    top: 0;
    width: 100%; /* PlnÃ¡ Å¡Ã­Å™ka */
    height: 100%; /* PlnÃ¡ vÃ½Å¡ka */
    overflow: auto; /* PovolÃ­ skrolovÃ¡nÃ­ v pÅ™Ã­padÄ› potÅ™eby */
    background-color: rgb(0,0,0); /* Fallback barva */
    background-color: rgba(0,0,0,0.4); /* ÄŒernÃ½ s prÅ¯hlednostÃ­ */
    }

	/* Obsah modÃ¡lnÃ­ho okna */
	.modal-content {
	  background-color: #fefefe;
	  margin: 5% auto; /* 5% odshora a vystÅ™edÄ›nÃ­ */
	  padding: 20px;
	  border: 1px solid #888;
	  border-radius: 15px; /* ZaoblenÃ© rohy */
	  width: 80%;
	}

	/* TlaÄÃ­tko pro zavÅ™enÃ­ modÃ¡lnÃ­ho okna */
	.close {
	  color: #aaa;
	  float: right;
	  font-size: 28px;
	  font-weight: bold;
	}

	.close:hover,
	.close:focus {
	  color: black;
	  text-decoration: none;
	  cursor: pointer;
	}
  </style>
</head>
<body>




<p><button class="help-button" onclick="selectBoardMenu()">ğŸ </button>&nbsp;<button id="helpButton" class="help-button" onclick="showHelp()">ğŸ’¡</button>&nbsp;<button class="help-button" >TREZOR</button>&nbsp;<button class="help-button" onclick="displayGameStatsInModal()">ğŸ†</button>&nbsp;<button id="helpButton" class="help-button" onclick="manualEndRound()">ğŸš«</button></p>
<div id="helpModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeHelp()">&times;</span>
  <h2>TREZOR</h2>
    <p>KostkovÃ¡ solitaire hra. ZdigitalizovanÃ¡ verze (JavaScript) PnP hry <b>"Vault: A Solitaire Dice Game (2021)"</b>, autorem je <b>Wayne Koenig</b></p>
    <p>Ve hÅ™e pÅ™edstavujete bankovnÃ­ho lupiÄe, kterÃ½ se snaÅ¾Ã­ prolomit specializovanÃ½ trezor. PomocÃ­ hodu kostkami a peÄlivÃ©ho plÃ¡novÃ¡nÃ­ doufÃ¡te, Å¾e se vÃ¡m podaÅ™Ã­ dostat ven s co nejvÄ›tÅ¡Ã­m poÄtem diamantÅ¯ dÅ™Ã­ve, neÅ¾ se vÅ¡echny zÃ¡mky na trezoru zavÅ™ou. NÄ›kterÃ© zÃ¡mky obsahujÃ­ vÃ­ce diamantÅ¯ neÅ¾ jinÃ©, takÅ¾e je na vÃ¡s, abyste se rozhodli, na kterÃ©m zÃ¡mku strÃ¡vÃ­te svÅ¯j Äas s ohledem na hozenÃ© hodnoty na kostkÃ¡ch.</p>
  <h3>PrÅ¯bÄ›h hry</h3>
    <p>Trezor, kterÃ½ se snaÅ¾Ã­te rozlousknout, mÃ¡ 12 zÃ¡mkÅ¯, na kaÅ¾dÃ©m z nich je pÃ­smeno, kterÃ© pÅ™edstavuje jedno kolo (A â€“ L). Na konci kaÅ¾dÃ©ho kola (v abecednÃ­m poÅ™adÃ­ pÃ­smen) se zavÅ™e pÅ™Ã­sluÅ¡nÃ½ zÃ¡mek, ÄÃ­mÅ¾ se odstranÃ­ Å¡ance na zÃ­skÃ¡nÃ­ diamantÅ¯ v jeho Å™adÄ› nebo sloupci.</p>
    <p>V kaÅ¾dÃ©m kole je tÅ™eba splnit 4 kroky:
       <ol>
         <li>Na zaÄÃ¡tku kaÅ¾dÃ©ho kola program automaticky vygeneruje hod 5 kostek</li>
         <li>PotÃ© kliknutÃ­m oznaÄte pole (ÄtvereÄky), kterÃ¡ odpovÃ­dajÃ­ hodnotÃ¡m (nebo jejich kombinaci) na hozenÃ½ch kostkÃ¡ch</li>
         <li>Jakmile pouÅ¾ijete vÅ¡ech 5 kostek, danÃ© kolo skonÄÃ­. ZÃ¡mek zÅ¯stane otevÅ™enÃ½ nebo se uzamkne v zÃ¡vislosti na tom, zda v danÃ©m kole budou u Å™eÅ¡enÃ©ho zÃ¡mku (v Å™Ã¡dku nebo sloupci) oznaÄena vÅ¡echna pole (ÄtvereÄky). Pokud ano, hodnota polÃ­ danÃ©ho zÃ¡mku se zmÄ›nÃ­ na znak âœ”ï¸. AktuÃ¡lnÄ› Å™eÅ¡enÃ½ zÃ¡mek mÃ¡ podbarvenÃ¡ polÃ­Äka Å¾lutou barvou, jiÅ¾ oznaÄenÃ¡ majÃ­ hodnotu ve Å¾lutÃ© barvÄ›.</li>
         <li>Postup opakujeme aÅ¾ do kola se zÃ¡mkem â€Lâ€œ, potÃ© hra konÄÃ­.</li>
       </ol>

  <h3>OznaÄenÃ­ polÃ­Äek</h3>
    <p>K oznaÄenÃ­ polÃ­Äek, kterÃ© se nachÃ¡zejÃ­ v Trezoru, nebo polÃ­Äek ve vÅ¡ech tÅ™ech â€Å perhÃ¡cÃ­châ€œ, mÅ¯Å¾ete v danÃ©m kole pouÅ¾Ã­t libovolnÃ½ poÄet nepouÅ¾itÃ½ch hozenÃ½ch kostek (hodnoty mÅ¯Å¾ete sÄÃ­tat nebo odeÄÃ­tat), jejichÅ¾ celkovÃ¡ hodnota se shoduje s konkrÃ©tnÃ­ ÄÃ­selnou hodnotou na polÃ­Äku v Trezoru. 
Na nÄ›kterÃ¡ polÃ­Äka staÄÃ­ pouze jedna kostka. Na vÄ›tÅ¡inÄ› polÃ­Äek v Trezoru je uvedeno ÄÃ­slo. U nÄ›kterÃ½ch je ale hodnota danÃ¡ znakem â€<b>L</b>â€œ (lichÃ¡), â€<b>S</b>â€œ (sudÃ¡) nebo â€<b>D</b>â€œ (double).
Na polÃ­Äko â€LichÃ¡â€œ nebo â€SudÃ¡â€œ je potÅ™eba pouze â€<b>jedna</b>â€œ kostka, jejÃ­ hodnota pak musÃ­ bÃ½t buÄ lichÃ¡ nebo sudÃ¡. NesmÃ­te kombinovat hodnoty dvou kostek tak, aby se rovnala hodnotÄ› tÅ™etÃ­ kostky.
Na polÃ­Äko â€<b>D</b>â€œ jsou ale tÅ™eba â€<b>dvÄ›</b>â€œ kostky, na hodnotÄ› nezÃ¡leÅ¾Ã­, ale hodnota musÃ­ bÃ½t na obou kostkÃ¡ch â€<b>stejnÃ¡</b>â€œ. NesmÃ­te kombinovat hodnoty dvou kostek tak, aby se rovnala hodnotÄ› tÅ™etÃ­ kostky.</p>

  <h3>Å perhÃ¡ky </h3>
    <p>Å perhÃ¡ky jsou zaÅ™Ã­zenÃ­, kterÃ¡ jsou pouÅ¾Ã­vanÃ¡ k prolamovÃ¡nÃ­ elektronickÃ½ch trezorÅ¯. Nechceme-li nebo nemÅ¯Å¾eme-li pouÅ¾Ã­t vÅ¡echny kostky k oznaÄenÃ­ polÃ­Äek v trezoru, mÅ¯Å¾ete kostky pouÅ¾Ã­t k nabÃ­jenÃ­ Å perhÃ¡ku. NabÃ­jenÃ­ Å perhÃ¡ku umoÅ¾Åˆuje uklÃ¡dat nepouÅ¾itÃ© kostky v danÃ©m kole tak, Å¾e se jejich hodnoty â€<b>seÄtou</b>â€œ a vÃ½slednÃ¡ hodnota se uloÅ¾Ã­ do kterÃ©hokoli ze tÅ™Ã­ Å perhÃ¡kÅ¯, kterÃ½ oznaÄÃ­me. KaÅ¾dou kostku lze pouÅ¾Ã­t pouze do jednoho Å perhÃ¡ku. KaÅ¾dÃ½ Å perhÃ¡k mÃ¡ maximÃ¡lnÃ­ hodotu 20.</p>
    <p>Å perhÃ¡k mÅ¯Å¾eme kdykoli v danÃ©m kole pouÅ¾Ã­t k oznaÄenÃ­ polÃ­Äka v Trezoru jako dalÅ¡Ã­ "virtuÃ¡lnÃ­" kostku, kterÃ¡ mÃ¡ pevnÄ› danou hodnotu, jakou mÃ¡ vybranÃ½ Å perhÃ¡k. MÅ¯Å¾eme jej  pouÅ¾Ã­t samostatnÄ› nebo v kombinaci (souÄet, odeÄet) s jakoukoli jinou oznaÄenou kostkou nebo jinÃ½m Å perhÃ¡kem aktivovanÃ½m jako virtuÃ¡lnÃ­ kostka.</p>
    <p>Je-li aktivovÃ¡na virtuÃ¡lnÃ­ kostka, <b>nelze</b> pouÅ¾Ã­t tlaÄÃ­tka pro opakovanÃ½ hod a dÃ¡le <b>nelze</b> v tuto chvÃ­li pÅ™idÃ¡vat hodnoty oznaÄenÃ½ch kostek do Å perhÃ¡ku. Chceme-li tedy pouÅ¾Ã­t vÃ­ce Å perhÃ¡kÅ¯ najednou jako virtuÃ¡lnÃ­ kostku, musÃ­me nejdÅ™Ã­ve Å perhÃ¡ky naplnit a potÃ© je aktivovat jako virtulnÃ­ kostky.</p>
    <p>âš ï¸ <b>Aktivace Å perhÃ¡ku je nevratnÃ½ Ãºkon.</b></p>
    <p>âš ï¸ <b>Jakmile je Å perhÃ¡k jiÅ¾ jednou pouÅ¾it, nelze do nÄ›j jiÅ¾ pÅ™idÃ¡vat, ani jej znovu pouÅ¾Ã­t.</b></p> 

  <h3>OpakovanÃ© hody</h3>
    <p>V prÅ¯bÄ›hu hry mÅ¯Å¾ete kdykoli 3x opakovat hod (i v prÅ¯bÄ›hu jednoho kola). PÅ™i opakovanÃ©m hodu mÅ¯Å¾ete pouÅ¾Ã­t libovolnÃ½ poÄet nepouÅ¾itÃ½ch kostek (1 â€“ 5).</p>
  
  <h3>KrÃ¡deÅ¾ diamantÅ¯</h3>
    <p>PodaÅ™Ã­-li se vÃ¡m v danÃ©m kole oznaÄit vÅ¡echna polÃ­Äka v pÅ™Ã­sluÅ¡nÃ©m sloupci Äi Å™Ã¡dku danÃ©ho zÃ¡mku, zÃ­skÃ¡vÃ¡te tento poÄet diamantÅ¯:
     <ul>
       <li>1 u zÃ¡mkÅ¯ A, B, C, D, E, F</li>
       <li>2 u zÃ¡mkÅ¯ G, H, I</li>
       <li>3 u zÃ¡mkÅ¯ J, K, L</li>
     </ul>
     PoznÃ¡mka: nÄ›kterÃ© zÃ¡mky majÃ­ vÃ­ce diamantÅ¯, z hlediska taktiky je tedy lepÅ¡Ã­ oznaÄit dÅ™Ã­ve polÃ­Äka ve sloupci Äi Å™Ã¡dku tÄ›chto zÃ¡mkÅ¯. 
    </p>
    
  <h3>Konec kola</h3>
    <p>Jakmile pouÅ¾ijete vÅ¡echny kostky, kolo konÄÃ­.</p>
    <p><b>PoznÃ¡mka:</b> pokud nelze pouÅ¾Ã­t vÅ¡echny kostky, ukonÄete kolo ruÄnÄ› pomocÃ­ tlaÄÃ­tka ğŸš« .</p>
    
  <h3>Konec hry</h3>  
    <p>Hra konÄÃ­, jakmile dokonÄÃ­te kolo se zÃ¡mkem â€Lâ€œ. Program spoÄÃ­tÃ¡ vÅ¡echny diamanty u otevÅ™enÃ½ch zÃ¡mkÅ¯ (za kaÅ¾dÃ½ 1 bod) a nepouÅ¾itÃ© Å perhÃ¡ky (za kaÅ¾dÃ½ 1 bod).</p>
    <p>Po ukonÄenÃ­ hry se ve spodnÃ­ ÄÃ¡sti zobrazÃ­ Å™Ã¡dek s hodnocenÃ­m:</p>
      <ul>
          <li>JdeÅ¡ do vÄ›zenÃ­</li>		  
          <li>Lapka&nbsp;&nbsp;&#11088;</li>
          <li>KapsÃ¡Å™&nbsp;&nbsp;&#11088;&#11088;</li>
          <li>ZlodÄ›j&nbsp;&nbsp;&#11088;&#11088;&#11088;</li>
          <li>BankovnÃ­ lupiÄ&nbsp;&nbsp;&#11088;&#11088;&#11088;&#11088;</li>
          <li>ArsÃ¨ne Lupin&nbsp;&nbsp;&#11088;&#11088;&#11088;&#11088;&#11088;</li>
      </ul>
	<p><b>PoznÃ¡mka:</b> ikony v hornÃ­m Å™Ã¡dku obrazovky s nÃ¡zvem hry</p> 
      <ul>
		  <li>ğŸ  menu s vÃ½bÄ›rem hracÃ­ desky</li> 
		  <li>ğŸ’¡ nÃ¡povÄ›da</li>
		  <li>ğŸ† statistiky hry </li>
		  <li>ğŸš« ruÄnÃ­ ukonÄenÃ­ kola (v poslednÃ­ch kolech se mÅ¯Å¾e stÃ¡t, Å¾e hrÃ¡Ä jiÅ¾ nebude mÃ­t k dispozici Å¾Ã¡dnÃ½ Å perhÃ¡k, opakovanÃ½ hod a hodnoty kostek neumoÅ¾nÃ­ dokonÄit standardnÃ­ cestou kolo).</li>
	  </ul>
      <p>&nbsp;</p>
      <p>&nbsp;</p>
  </div>
</div>

<div id="statsModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeStatsModal()">&times;</span>
    <h2>Statistiky hry</h2>
    <div id="totalStats"></div>
    <div id="boardStats"></div>
  </div>
</div>

<div id="gameContainer">
  <!-- OznaÄenÃ­ sloupcÅ¯ nahoÅ™e -->
  <div id="letters">
    <div></div><div></div><div id="lockA">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A</div><div></div><div id="lockB">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B</div><div></div><div id="lockC">C</div>
  </div>

  <!-- OznaÄenÃ­ Å™Ã¡dkÅ¯ vlevo a vpravo -->
  <div id="left">
    <div id="lockL">L</div>
    <div></div>
    <div id="lockK">K</div>
    <div></div>
    <div id="lockJ">J</div>
    <div></div>
  </div>

  <!-- HracÃ­ deska -->
  <div id="board"></div>

  <div id="right">
    <div></div>
    <div id="lockD">D</div>
    <div></div>
    <div id="lockE">E</div>
    <div></div>
    <div id="lockF">F</div>
  </div>

  <!-- OznaÄenÃ­ sloupcÅ¯ dole -->
  <div id="bottom">
    <div></div><div id="lockI">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I</div><div></div><div id="lockH">&nbsp;&nbsp;&nbsp;&nbsp;H</div><div></div><div id="lockG">G</div><div></div>
  </div>

  <!-- Skimmery jako tlaÄÃ­tka -->
  <div id="skimmers">
    <div class="skimmer" onclick="showSkimmerOptions(0)">S1: <span id="skimmer1">0</span>/20</div>&nbsp;
    <div class="skimmer" onclick="showSkimmerOptions(1)">S2: <span id="skimmer2">0</span>/20</div>&nbsp;
    <div class="skimmer" onclick="showSkimmerOptions(2)">S3: <span id="skimmer3">0</span>/20</div>
  </div>
</div>
</br>
<!-- TlaÄÃ­tka ReRoll -->
<div id="rerolls">
  <button id="reRoll1" onclick="reRollDice(1)" class="reroll-button">Hod 1</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <button id="reRoll2" onclick="reRollDice(2)" class="reroll-button">Hod 2</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <button id="reRoll3" onclick="reRollDice(3)" class="reroll-button">Hod 3</button>
</div>
</br>
<!-- Kostky -->
<div id="diceContainer">
  <div class="die" onclick="toggleDie(0)">1</div>
  <div class="die" onclick="toggleDie(1)">2</div>
  <div class="die" onclick="toggleDie(2)">3</div>
  <div class="die" onclick="toggleDie(3)">4</div>
  <div class="die" onclick="toggleDie(4)">5</div>
</div></br>


<table border="0">
<tr>
<td class="score"></td>
<td class="score" id="score">0</td>
</tr>
<tr>
<td class="highscore"></td>
<td class="highscore" id="high-score">0</td>
<tr>
<td class="highscore"></td>
<td class="highscore" id="final-rating"></td>
</tr>

</tr>
</table>


<script type="text/javascript">


// Funkce pro aktualizaci barev zÃ¡mkÅ¯ po ukonÄenÃ­ kola
function updateLockColors() {
  for (const lock of locks) {
    const lockElement = document.getElementById(`lock${lock.name}`);
    if (lockElement) {
      console.log(`Updating color for lock ${lock.name}: isDetermined=${lock.isDetermined}, isOpen=${lock.isOpen}`);
      if (!lock.isDetermined) {
        lockElement.style.color = 'black'; // Pokud nenÃ­ stav urÄen, zÃ¡mek je ÄernÃ½
      } else {
        lockElement.style.color = lock.isOpen ? 'limegreen' : 'red'; // Pokud je stav urÄen, zÃ¡mek je zelenÃ½ nebo ÄervenÃ½
      }
    }
  }
}

function handleEndRound() {
  const lock = locks[currentRound - 1];
  const allCellsFilled = lock.coordinates.every(({ row, col }) => {
    const cell = document.getElementById(`cell-${row}-${col}`);
    return cell.classList.contains('clicked');
  });

  if (allCellsFilled) {
    lock.coordinates.forEach(({ row, col }) => {
      const cell = document.getElementById(`cell-${row}-${col}`);
      cell.classList.add('opened');
      cell.textContent = 'âœ”ï¸';
    });
 
    lock.isOpen = true; // NastavÃ­me stav zÃ¡mku na otevÅ™enÃ½
    confirm(`ZÃ¡mek ${lock.name} zÅ¯stÃ¡vÃ¡ otevÅ™enÃ½, poÄet zÃ­skanÃ½ch diamantÅ¯: ${lockPoints[lock.name]}.`);
  } else {
    lock.isOpen = false; // NastavÃ­me stav zÃ¡mku na uzavÅ™enÃ½
    confirm(`ZÃ¡mek ${lock.name} se uzamknul.`);
  }

  lock.isDetermined = true; // OznaÄÃ­me, Å¾e stav zÃ¡mku je urÄen
  console.log(`Lock ${lock.name} status determined: isOpen=${lock.isOpen}`);
  updateLockColors();
}


let dice = [0, 0, 0, 0, 0]; // Hodnoty kostek
let selectedDice = []; // UchovÃ¡nÃ­ vybranÃ½ch kostek
let virtualDice = null; // UchovÃ¡nÃ­ virtuÃ¡lnÃ­ kostky ze skimmeru
let BoardId = null;
let currentRound = 1; // AktuÃ¡lnÃ­ kolo
let score = 0; // Body hrÃ¡Äe
let skimmers = [0, 0, 0]; // Hodnoty pro skimmery
let unusedSkimmers = 0; // Pocet nepouÅ¾itÃ½ch SkimmerÅ¯
let anySkimmerAsDie = false; // PÅ™idÃ¡nÃ­ promÄ›nnÃ© pro sledovÃ¡nÃ­ stavu virtuÃ¡lnÃ­ kostky
const totalRounds = 12; // PoÄet kol



  // Funkce pro vÃ½bÄ›r hraciÃ­ desky 
	function selectBoard() {
  const option = prompt(`Hra Trezor - vyberte hernÃ­ desku:\n(zadejte ÄÃ­slo desky 1 - 18)`);
  if (option === "1" || option === "01") {
    boardLayout = boardLayoutA;
    locks = locksA;  // Definice zamku pro desku A
    boardId = 'A'; // NastavÃ­me boardId pro desku A
  } else if (option === "2" || option === "02") {
    boardLayout = boardLayoutB;
    locks = locksB;  // Definice zamku pro desku B
    boardId = 'B'; // NastavÃ­me boardId pro desku B
  } else if (option === "3" || option === "03") {
    boardLayout = boardLayoutC;
    locks = locksB;  // Definice zamku pro desku C - stejna jako pro B
    boardId = 'C'; // NastavÃ­me boardId pro desku C
  } else if (option === "4" || option === "04") {
    boardLayout = boardLayoutD;
    locks = locksB;  // Definice zamku pro desku D - stejna jako pro B
    boardId = 'D'; // NastavÃ­me boardId pro desku D
  } else if (option === "5" || option === "05") {
    boardLayout = boardLayoutE;
    locks = locksB;  // Definice zamku pro desku E - stejna jako pro B
    boardId = 'E'; // NastavÃ­me boardId pro desku E
  } else if (option === "6" || option === "06") {
    boardLayout = boardLayoutF;
    locks = locksF;  //Definice zamku pro desku F
    boardId = 'F'; // NastavÃ­me boardId pro desku F
  } else if (option === "7" || option === "07") {
    boardLayout = boardLayoutG;
    locks = locksG;  //Definice zamku pro desku G
    boardId = 'G'; // NastavÃ­me boardId pro desku G
  } else if (option === "8" || option === "08") {
    boardLayout = boardLayoutH;
    locks = locksG;  //Definice zamku pro desku H - stejna jako pro G
    boardId = 'H'; // NastavÃ­me boardId pro desku H
  } else if (option === "9" || option === "09") {
    boardLayout = boardLayoutI;
    locks = locksI;  //Definice zamku pro desku I
    boardId = 'I'; // NastavÃ­me boardId pro desku I
  } else if (option === "10") {
    boardLayout = boardLayoutJ;
    locks = locksG;  //Definice zamku pro desku J - stejna jako pro G
    boardId = 'J'; // NastavÃ­me boardId pro desku J
	} else if (option === "11") {
    boardLayout = boardLayoutK;
    locks = locksG;  //Definice zamku pro desku K - stejna jako pro G
    boardId = 'K'; // NastavÃ­me boardId pro desku K
	} else if (option === "12") {
    boardLayout = boardLayoutL;
    locks = locksG;  //Definice zamku pro desku L - stejna jako pro G
    boardId = 'L'; // NastavÃ­me boardId pro desku L
	} else if (option === "13") {
    boardLayout = boardLayoutM;
    locks = locksB;  //Definice zamku pro desku M - stejna jako pro B
    boardId = 'M'; // NastavÃ­me boardId pro desku M
	} else if (option === "14") {
    boardLayout = boardLayoutN;
    locks = locksB;  //Definice zamku pro desku N - stejna jako pro B
    boardId = 'N'; // NastavÃ­me boardId pro desku N
	} else if (option === "15") {
    boardLayout = boardLayoutO;
    locks = locksO;  //Definice zamku pro desku O
    boardId = 'O'; // NastavÃ­me boardId pro desku O
	} else if (option === "16") {
    boardLayout = boardLayoutP;
    locks = locksP;  //Definice zamku pro desku P
    boardId = 'P'; // NastavÃ­me boardId pro desku P
	} else if (option === "17") {
    boardLayout = boardLayoutQ;
    locks = locksQ;  //Definice zamku pro desku Q
    boardId = 'Q'; // NastavÃ­me boardId pro desku Q
	} else if (option === "18") {
    boardLayout = boardLayoutR;
    locks = locksR;  //Definice zamku pro desku R
    boardId = 'R'; // NastavÃ­me boardId pro desku R
  } else {
    confirm("NeplatnÃ¡ volba. Zkuste to znovu.");
    selectBoard(); // OpakovÃ¡nÃ­ vÃ½bÄ›ru
    return ;
  }
}

  // VytvoÅ™enÃ­ hernÃ­ desky
  function createBoard() {
    const boardDiv = document.getElementById('board');

if (!boardDiv) {
    console.error("Chyba: Element s ID 'board' nebyl nalezen.");
    alert("Chyba: Nemohu najÃ­t prvek pro hracÃ­ desku.");
    return;
  }
  boardDiv.innerHTML = ''; // OdstranÄ›nÃ­ starÃ©ho obsahu

    for (let row = 0; row < boardLayout.length; row++) {
      for (let col = 0; col < boardLayout[row].length; col++) {
        const cellValue = boardLayout[row][col];
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.id = `cell-${row}-${col}`;
        cell.innerText = cellValue;

        if (cellValue === 'x') {
          cell.classList.add('disabled');
        } else {
          cell.onclick = () => markCell(row, col, cellValue); 
        }

        if (cellValue === 'L') cell.classList.add('odd');
        else if (cellValue === 'S') cell.classList.add('even');
        else if (cellValue === 'D') cell.classList.add('double');

        boardDiv.appendChild(cell);
      }
    }
  }	
  
  // Funkce pro zahÃ¡jenÃ­ hry
function startGame() {

if (!locks) {
    console.error("Chyba: locks nejsou inicializovÃ¡ny.");
    return;
}
  currentRound = 1;
  score = 0;
  rollDice();
  startRound();
  document.getElementById('score').innerText = `Deska ${boardId} - poÄet bodÅ¯: ${score}`;
 
// OvÄ›Å™te, Å¾e boardId je nastavenÃ© pÅ™ed naÄÃ­tÃ¡nÃ­m skÃ³re
  if (boardId) {
    const highScore = loadHighScore(boardId);
    document.getElementById('high-score').innerText = `Deska ${boardId} - nejvyÅ¡Å¡Ã­ dosaÅ¾enÃ© skÃ³re: ${highScore}`;
  } else {
    console.error("boardId nenÃ­ definovÃ¡no pÅ™i naÄÃ­tÃ¡nÃ­ skÃ³re");
  }
}

	function selectBoardMenu() {
	location.reload();
	}
	

// OtevÅ™enÃ­ modÃ¡lnÃ­ho okna
function showHelp() {
  document.getElementById('helpModal').style.display = 'block';
}

function closeHelp() {
  document.getElementById('helpModal').style.display = 'none';
}


// OtevÅ™enÃ­ modÃ¡lnÃ­ho okna
function displayGameStatsInModal() {
  document.getElementById('statsModal').style.display = 'block';
}

function closeGameStatsInModal() {
  document.getElementById('statsModal').style.display = 'none';
}

// ZavÅ™enÃ­ modÃ¡lnÃ­ho okna, kdyÅ¾ uÅ¾ivatel klikne mimo nÄ›j
window.onclick = function(event) {
  if (event.target == document.getElementById('statsModal')) {
    document.getElementById('statsModal').style.display = 'none';
  } else if (event.target == document.getElementById('helpModal')) {
    document.getElementById('helpModal').style.display = 'none';
}
}


  const boardLayoutA = [

    ['20', 'x', '6', '15', '4', '13', '12'],
    ['x', '7', '2', 'S', 'x', '5', 'x'],
    ['10', '11', 'L', 'x', 'D', '9', '6'],
    ['x', '14', 'x', '5', 'x', '3', '2'],
    ['9', '15', '4', 'D', '3', 'x', '4'],
    ['x', '12', 'x', '6', '5', '10', 'x']
  ];


  const boardLayoutB = [

    ['19', 'x', '5', '14', '6', '13', 'x'],
    ['x', '7', '1', 'x', 'x', '3', 'x'],
    ['8', 'D', 'x', 'x', '10', '8', '4'],
    ['x', '14', 'x', '4', 'x', 'x', '6'],
    ['9', '16', 'S', '12', 'x', 'x', '1'],
    ['x', 'x', 'x', '3', '5', '11', 'x']
 ];


  const boardLayoutC = [

    ['19', 'x', '5', '17', '6', '13', 'x'],
    ['x', '8', '6', 'x', 'x', 'L', 'x'],
    ['10', '11', 'x', 'x', '10', '7', '6'],
    ['x', '16', 'x', '1', 'x', 'x', 'L'],
    ['D', '13', '4', '7', 'x', 'x', '3'],
    ['x', 'x', 'x', '5', 'S', '10', 'x']
 ];


  const boardLayoutD = [

    ['19', 'x', 'S', '13', '1', '14', 'x'],
    ['x', '9', '2', 'x', 'x', '1', 'x'],
    ['11', '8', 'x', 'x', '12', '9', '1'],
    ['x', '17', 'x', '6', 'x', 'x', '5'],
    ['7', '15', '6', '12', 'x', 'x', '2'],
    ['x', 'x', 'x', '1', '3', '7', 'x']
 ];


  const boardLayoutE = [

    ['21', 'x', '2', '18', '5', '14', 'x'],
    ['x', '8', '6', 'x', 'x', 'S', 'x'],
    ['9', '7', 'x', 'x', '8', '6', '2'],
    ['x', '18', 'x', '1', 'x', 'x', '4'],
    ['10', '16', '2', '9', 'x', 'x', '3'],
    ['x', 'x', 'x', 'L', '4', '11', 'x']
 ];


  const boardLayoutF = [

    ['23', 'x', '4', '14', 'L', '16', '7'],
    ['x', '8', 'S', 'x', 'x', 'L', 'x'],
    ['10', '9', 'x', 'x', '12', '7', '3'],
    ['x', '14', 'x', '6', 'x', '4', '1'],
    ['7', '15', 'L', '11', '3', 'x', '6'],
    ['x', 'x', 'x', '1', '2', '9', 'x']
 ];

  const boardLayoutG = [

    ['19', 'x', '2', '17', '3', '18', '12'],
    ['x', '12', '5', 'S', 'x', '1', 'x'],
    ['7', '10', '1', 'x', '9', '11', '2'],
    ['x', '15', 'x', 'L', 'x', '6', '1'],
    ['D', '16', 'S', '11', '3', 'x', '4'],
    ['x', '10', 'x', '3', '2', 'D', 'x']
 ];


  const boardLayoutH = [

    ['23', 'x', '6', '17', 'L', '16', '12'],
    ['x', 'D', 'L', '3', 'x', 'S', 'x'],
    ['8', '14', '1', 'x', '11', '12', '6'],
    ['x', '9', 'x', 'L', 'x', '3', '4'],
    ['11', '15', '2', '10', '1', 'x', '5'],
    ['x', '8', 'x', '1', '4', '7', 'x']
 ];



  const boardLayoutI = [

    ['21', 'x', '3', '15', 'L', '13', 'x'],
    ['x', 'D', '6', 'x', 'x', '3', 'x'],
    ['11', '7', '4', 'x', '6', '8', '3'],
    ['x', '16', 'x', '5', 'x', 'x', '4'],
    ['9', '15', '5', '8', '2', 'x', '6'],
    ['x', 'D', 'x', '4', '1', '9', 'x']
 ];


  const boardLayoutJ = [

    ['23', 'x', '6', '14', '1', '15', '12'],
    ['x', '10', '2', '5', 'x', '3', 'x'],
    ['8', '14', '1', 'x', '7', '10', 'L'],
    ['x', '8', 'x', '3', 'x', '2', '1'],
    ['9', '16', '3', '12', 'L', 'x', '4'],
    ['x', 'D', 'x', '4', 'S', '9', 'x']
 ];


  const boardLayoutK = [

    ['22', 'x', '2', '14', '5', '16', 'D'],
    ['x', '7', '4', '2', 'x', 'L', 'x'],
    ['8', '16', '3', 'x', '7', '11', 'L'],
    ['x', 'D', 'x', '6', 'x', '3', '2'],
    ['9', '17', '1', 'D', '1', 'x', '6'],
    ['x', '8', 'x', 'S', '2', '12', 'x']
 ];

  const boardLayoutL = [

    ['19', 'x', '5', '17', '3', '14', 'D'],
    ['x', '8', '3', '4', 'x', '1', 'x'],
    ['7', '13', '1', 'x', '10', '11', '3'],
    ['x', 'D', 'x', '1', 'x', '5', '4'],
    ['10', '16', '3', 'D', 'L', 'x', '1'],
    ['x', '10', 'x', '6', '4', '12', 'x']
 ];

  const boardLayoutM = [

    ['20', 'x', 'S', '14', 'L', '16', 'x'],
    ['x', '12', '5', 'x', 'x', 'L', 'x'],
    ['7', '11', 'x', 'x', '8', '7', '3'],
    ['x', '14', 'x', '1', 'x', 'x', '5'],
    ['D', '16', '1', '10', 'x', 'x', '4'],
    ['x', 'x', 'x', 'S', '2', '10', 'x']

 ];

  const boardLayoutN = [

    ['19', 'x', '4', '13', 'S', '17', 'x'],
    ['x', '9', '2', 'x', 'x', '3', 'x'],
    ['8', '14', 'x', 'x', '9', '11', 'L'],
    ['x', '15', 'x', 'S', 'x', 'x', '2'],
    ['12', '10', '5', '9', 'x', 'x', '3'],
    ['x', 'x', 'x', '3', '5', '10', 'x']
 ];

  const boardLayoutO = [

    ['23', 'x', '6', '14', '2', '16', '7'],
    ['x', 'D', '2', '4', 'x', '3', 'x'],
    ['7', '17', '1', 'x', '7', '9', '5'],
    ['x', '12', 'x', '6', 'x', 'x', '4'],
    ['D', '15', '5', '8', 'x', 'x', '3'],
    ['x', 'x', 'x', '5', '1', 'D', 'x']
 ];

  const boardLayoutP = [

    ['21', 'x', '2', '17', 'L', '15', '9'],
    ['x', '10', '3', 'S', 'x', '2', 'x'],
    ['D', '11', 'x', 'x', '9', '10', '2'],
    ['x', '14', 'x', '6', 'x', '4', 'S'],
    ['12', '15', 'L', '7', 'x', 'x', '4'],
    ['x', 'x', 'x', '6', '5', '7', 'x']
 ];

  const boardLayoutQ = [

    ['24', 'x', '1', '14', '2', '16', 'x'],
    ['x', '10', '1', 'L', 'x', '3', 'x'],
    ['7', '17', '6', 'x', '12', '11', 'S'],
    ['x', '9', 'x', '4', 'x', 'x', '5'],
    ['9', '18', '3', 'D', 'x', 'x', '6'],
    ['x', '9', 'x', '5', '1', '8', 'x']
 ];

  const boardLayoutR = [

    ['20', 'x', '4', '15', '3', '17', 'x'],
    ['x', '9', '9', 'L', 'x', '3', 'x'],
    ['12', '18', 'x', 'x', '9', '19', '2'],
    ['x', '11', 'x', 'L', 'x', '1', '5'],
    ['D', '17', 'S', '11', '4', 'x', '1'],
    ['x', '10', 'x', 'S', '5', '11', 'x']
 ];


const locksA = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 2, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 4, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 0, col: 6 }, { row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 3 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 5 }, { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 1 }, { row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 3, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 1, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }, { row: 5, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 4 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 2 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }, { row: 0, col: 6 }] }
]; 

const locksB = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }] }
]; 

const locksF = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 4, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 0, col: 6 }, { row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 5 }, { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 4 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }, { row: 0, col: 6 }] }
]; 


const locksG = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 2, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 4, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 0, col: 6 }, { row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 3 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 5 }, { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 1 }, { row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 3, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 1, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }, { row: 5, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 4 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 2 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }, { row: 0, col: 6 }] }
]; 


const locksI = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 2, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 4, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 1 }, { row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }, { row: 5, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 4 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 2 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }] }
]; 

const locksO = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 2, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 0, col: 6 }, { row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 3 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 1, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 2 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }, { row: 0, col: 6 }] }
]; 

const locksP = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 0, col: 6 }, { row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 3 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 5 },  { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 3, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 1, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }, { row: 0, col: 6 }] }
]; 

const locksQ = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 2, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 3 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 1 }, { row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 1, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }, { row: 5, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 2 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }] }
]; 

const locksR = [
	 { name: "A", coordinates: [{ row: 0, col: 2 }, { row: 1, col: 2 }, { row: 4, col: 2 }] },
	 { name: "B", coordinates: [{ row: 0, col: 4 }, { row: 2, col: 4 }, { row: 4, col: 4 }, { row: 5, col: 4 }] },
	 { name: "C", coordinates: [{ row: 2, col: 6 }, { row: 3, col: 6 }, { row: 4, col: 6 }] },
	 { name: "D", coordinates: [{ row: 1, col: 1 }, { row: 1, col: 2 }, { row: 1, col: 3 }, { row: 1, col: 5 }] },
	 { name: "E", coordinates: [{ row: 3, col: 1 }, { row: 3, col: 3 }, { row: 3, col: 5 }, { row: 3, col: 6 }] },
	 { name: "F", coordinates: [{ row: 5, col: 1 }, { row: 5, col: 3 }, { row: 5, col: 4 }, { row: 5, col: 5 }] },
	 { name: "G", coordinates: [{ row: 0, col: 5 }, { row: 1, col: 5 }, { row: 2, col: 5 }, { row: 3, col: 5 }, { row: 5, col: 5 }] },
	 { name: "H", coordinates: [{ row: 0, col: 3 }, { row: 1, col: 3 }, { row: 3, col: 3 }, { row: 4, col: 3 }, { row: 5, col: 3 }] },
	 { name: "I", coordinates: [{ row: 1, col: 1 }, { row: 2, col: 1 }, { row: 3, col: 1 }, { row: 4, col: 1 }, { row: 5, col: 1 }] },
	 { name: "J", coordinates: [{ row: 4, col: 0 }, { row: 4, col: 1 }, { row: 4, col: 2 }, { row: 4, col: 3 }, { row: 4, col: 4 }, { row: 4, col: 6 }] },
	 { name: "K", coordinates: [{ row: 2, col: 0 }, { row: 2, col: 1 }, { row: 2, col: 4 }, { row: 2, col: 5 }, { row: 2, col: 6 }] },
	 { name: "L", coordinates: [{ row: 0, col: 0 }, { row: 0, col: 2 }, { row: 0, col: 3 }, { row: 0, col: 4 }, { row: 0, col: 5 }] }
]; 


const lockPoints = { A: 1, B: 1, C: 1, D: 1, E: 1, F: 1, G: 2, H: 2, I: 2, J: 3, K: 3, L: 3 }; // Body za zÃ¡mky


// VÃ½chozÃ­ struktura statistik
const defaultStats = {
  totalGames: 0,
  boards: {}, // Statistiky pro kaÅ¾dou desku
};

// NaÄtenÃ­ statistik z localStorage
function loadGameStats() {
  const stats = localStorage.getItem('gameStats');
  return stats ? JSON.parse(stats) : { ...defaultStats };
}

// UloÅ¾enÃ­ statistik do localStorage
function saveGameStats(stats) {
  localStorage.setItem('gameStats', JSON.stringify(stats));
}

// Aktualizace statistik po ukonÄenÃ­ hry
function updateGameStats(boardId, score) {
  const stats = loadGameStats();
  
  // CelkovÃ© statistiky
  stats.totalGames += 1;

  // Statistiky pro konkrÃ©tnÃ­ desku
  if (!stats.boards[boardId]) {
    stats.boards[boardId] = { gamesPlayed: 0, totalScore: 0, highestScore: 0 };
  }

  const boardStats = stats.boards[boardId];
  boardStats.gamesPlayed += 1;
  boardStats.totalScore += score;
  if (score > boardStats.highestScore) {
    boardStats.highestScore = score;
  }

  saveGameStats(stats);
}

// ZajistÃ­me, Å¾e getLowestScoreBoard pouÅ¾Ã­vÃ¡ loadHighScore:
function getLowestScoreBoard(stats) {
  let lowestScore = Infinity;
  let worstBoardId = '';

 Object.keys(stats.boards).forEach(boardId => {
    const highScore = loadHighScore(boardId);
    if (highScore < lowestScore) {
      lowestScore = highScore;
      worstBoardIds = [boardId];
    } else if (highScore === lowestScore) {
      worstBoardIds.push(boardId);
    }
  });

  return { worstBoardIds, lowestScore };
}

	//ZajistÃ­me, Å¾e getHighestScoreBoard pouÅ¾Ã­vÃ¡ loadHighScore:
function getHighestScoreBoard(stats) {
  let highestScore = -Infinity;
  let bestBoardId = '';

Object.keys(stats.boards).forEach(boardId => {
    const highScore = loadHighScore(boardId);
    if (highScore > highestScore) {
      highestScore = highScore;
      bestBoardIds = [boardId];
    } else if (highScore === highestScore) {
      bestBoardIds.push(boardId);
    }
  });

  return { bestBoardIds, highestScore };
}

function displayGameStatsInModal() {
  const stats = loadGameStats();

  const totalStatsDiv = document.getElementById('totalStats');
  totalStatsDiv.innerHTML = `<p><strong>CelkovÃ½ poÄet her:</strong> ${stats.totalGames}</p>`;

  // ZÃ­skÃ¡nÃ­ desky s nejvyÅ¡Å¡Ã­m skÃ³re
  const { bestBoardId, highestScore } = getHighestScoreBoard(stats);
  totalStatsDiv.innerHTML += `<p><strong>NejvyÅ¡Å¡Ã­ skÃ³re:</strong> ${highestScore} (${bestBoardIds.join(', ')})</p>`;
  
  // ZÃ­skÃ¡nÃ­ desky s nejniÅ¾Å¡Ã­m skÃ³re
  const { worstBoardId, lowestScore } = getLowestScoreBoard(stats);
  totalStatsDiv.innerHTML += `<p><strong>NejniÅ¾Å¡Ã­ skÃ³re:</strong> ${lowestScore} (${worstBoardIds.join(', ')})</p>`;

  // DynamickÃ© zjiÅ¡tÄ›nÃ­ nejÄastÄ›ji hranÃ© desky
  let mostPlayedBoardId = '';
  let mostPlayedGames = 0;

  Object.keys(stats.boards).forEach(boardId => {
    const boardStats = stats.boards[boardId];
    if (boardStats.gamesPlayed > mostPlayedGames) {
      mostPlayedBoardId = boardId;
      mostPlayedGames = boardStats.gamesPlayed;
    }
  });

  totalStatsDiv.innerHTML += `<p><strong>NejÄastÄ›ji hranÃ¡:</strong> ${mostPlayedGames} (${mostPlayedBoardId})</p>`;

  const boardStatsDiv = document.getElementById('boardStats');
  boardStatsDiv.innerHTML = '<h3>Statistiky jednotlivÃ½ch desek</h3>';

  // ZÃ­skÃ¡me vÅ¡echny desky, seÅ™adÃ­me je podle `boardId` abecednÄ›
  const sortedBoards = Object.keys(stats.boards).sort();

  sortedBoards.forEach(boardId => {
    const boardStats = stats.boards[boardId];
    const highScore = loadHighScore(boardId); // NaÄtenÃ­ nejvyÅ¡Å¡Ã­ho skÃ³re
    const averageScore = (boardStats.totalScore / boardStats.gamesPlayed).toFixed(2);

    boardStatsDiv.innerHTML += `
      <div>
        <strong>Deska ${boardId}:</strong>
		<ul>
        <li>poÄet her: ${boardStats.gamesPlayed}</li>
        <li>prÅ¯mÄ›rnÃ© skÃ³re: ${averageScore}</li>
        <li>nejvyÅ¡Å¡Ã­ skÃ³re: ${boardStats.highestScore}</li>
		</ul>
      </div>
      </br>
    `;
  });

  const modal = document.getElementById('statsModal');
  modal.style.display = 'block';
}


// ZavÅ™enÃ­ modal okna
function closeStatsModal() {
  const modal = document.getElementById('statsModal');
  modal.style.display = 'none';
}


function loadHighScore(boardId) {
  const savedScore = localStorage.getItem(`highScore_${boardId}`);
  console.log(`NaÄÃ­tÃ¡nÃ­ nejvyÅ¡Å¡Ã­ho skÃ³re pro desku ${boardId}:`, savedScore); // PÅ™idÃ¡no logovÃ¡nÃ­
  return savedScore ? parseInt(savedScore, 10) : 0;
}

function saveHighScore(score, boardId) {
  localStorage.setItem(`highScore_${boardId}`, score);
  console.log(`UklÃ¡dÃ¡nÃ­ novÃ©ho nejvyÅ¡Å¡Ã­ho skÃ³re pro desku ${boardId}:`, score); // PÅ™idÃ¡no logovÃ¡nÃ­
}



// Funkce pro zÃ­skÃ¡nÃ­ skuteÄnÃ© barvy pozadÃ­ elementu
function getBackgroundColor(element) {
    return window.getComputedStyle(element, null).getPropertyValue('background-color');
}

// Funkce pro hod kostkami
function rollDice() {
  dice = Array.from({ length: 5 }, () => Math.floor(Math.random() * 6) + 1);
  const diceElements = document.querySelectorAll('.die');
  dice.forEach((value, index) => {
    diceElements[index].classList.add('rolling');
    setTimeout(() => {
      diceElements[index].innerText = value;
      diceElements[index].classList.remove('rolling', 'clicked', 'used');
    }, 750); // ÄŒas pro animaci
  });
  selectedDice = [];
}

// Funkce pro zahÃ¡jenÃ­ novÃ©ho kola
function startRound() {
      // VyÄiÅ¡tÄ›nÃ­ pÅ™edchozÃ­ho zvÃ½raznÄ›nÃ­
  locks.forEach(lock => {
    lock.coordinates.forEach(({ row, col }) => {
      const cell = document.getElementById(`cell-${row}-${col}`);
      cell.classList.remove('highlight', 'highlight-empty', 'highlight-filled');
      cell.style.color = ''; // Resetuje barvu textu
      cell.style.fontWeight = ''; // Resetuje tucneÄnÃ© pismo textu
	const rating = getRating(score);
 	document.getElementById('final-rating').innerHTML = ``;
    });
  });
const currentLock = locks[currentRound - 1];
const lockName = currentLock.name;

// ZvÃ½raznÄ›nÃ­ aktuÃ¡lnÃ­ho zÃ¡mku
  currentLock.coordinates.forEach(({ row, col }) => {
    const cell = document.getElementById(`cell-${row}-${col}`);
    const backgroundColor = getBackgroundColor(cell);
    if (backgroundColor === 'rgb(75, 76, 75)') {
            // Pokud je barva pozadÃ­ buÅˆky Å¡edÃ¡ (rgb(128, 128, 128))
            
            cell.style.color = 'yellow'; // NastavenÃ­ Å¾lutÃ© barvy textu pro buÅˆky s Å¡edÃ½m pozadÃ­m
            cell.style.fontWeight = 'bold'; // NastavenÃ­ tuÄnÃ©ho pÃ­sma pro buÅˆky s Å¡edÃ½m pozadÃ­m
        } else {
            // Pokud je buÅˆka nevyplnÄ›nÃ¡
            cell.classList.add('highlight-empty');
        }
    
    
   
  });
  if (currentRound > totalRounds) {
    alert("Hra skonÄila!");
    return;
  }
  // alert(`Zahajuje se kolo ${currentRound}: Å˜eÅ¡Ã­me zÃ¡mek ${currentLock.name} na desce ${boardId}`);
}



// Kontrola, zda byly vÅ¡echny kostky pouÅ¾ity
function checkAllDiceUsed() {
  const allUsed = Array.from(document.querySelectorAll('.die')).every(die => die.classList.contains('used'));
  if (allUsed) {
    endRound();
  }
}


function getRating(score) {
  if (score < 10) {
    return "JdeÅ¡ do vÄ›zenÃ­";
  } else if (score <= 12) {
    return "Lapka&nbsp;&nbsp;&#11088;";
  } else if (score <= 15) {
    return "KapsÃ¡Å™&nbsp;&nbsp;&#11088;&#11088;";
  } else if (score <= 18) {
    return "ZlodÄ›j&nbsp;&nbsp;&#11088;&#11088;&#11088;";
  } else if (score <= 21) {
    return "BankovnÃ­ lupiÄ&nbsp;&nbsp;&#11088;&#11088;&#11088;&#11088;";
  } else {
    return "ArsÃ¨ne Lupin&nbsp;&nbsp;&#11088;&#11088;&#11088;&#11088;&#11088;";
  }
}


// Funkce pro vÃ½poÄet zÃ¡vÄ›reÄnÃ©ho skÃ³re vÄetnÄ› nepouÅ¾itÃ½ch skimmerÅ¯
function calculateFinalScore() {
  let unusedSkimmers = 0;

  document.querySelectorAll('.skimmer').forEach((skimmer) => {
    if (!skimmer.classList.contains('disabled')) {
      unusedSkimmers++;
    }
  });

  // PÅ™iÄtenÃ­ bodÅ¯ za nepouÅ¾itÃ© skimmery
  score += unusedSkimmers;

  confirm(`KoneÄnÃ© skÃ³re: ${score} (zahrnuje poÄet bodÅ¯ za nepouÅ¾itÃ© Å perhÃ¡ky: ${unusedSkimmers})`);
	// VÃ½poÄet hodnocenÃ­ na zÃ¡kladÄ› skÃ³re
  const rating = getRating(score);
 document.getElementById('final-rating').innerHTML = `HodnocenÃ­: ${rating}`;


  // NaÄtÄ›te nejvyÅ¡Å¡Ã­ skÃ³re pro aktuÃ¡lnÃ­ desku
  const highScore = loadHighScore(boardId);
  console.log(`PorovnÃ¡nÃ­ aktuÃ¡lnÃ­ho skÃ³re ${score} s nejvyÅ¡Å¡Ã­m skÃ³re ${highScore} pro desku ${boardId}`);

  if (score > highScore) {
    saveHighScore(score, boardId);
    confirm(`Gratulujeme! DosÃ¡hli jste novÃ©ho vysokÃ©ho skÃ³re: ${score}`);
  }

  // Aktualizace zobrazenÃ­ skÃ³re na obrazovce
 
  document.getElementById('score').innerText = `Deska ${boardId} - poÄet bodÅ¯: ${score}`;
  document.getElementById('high-score').innerText = `Deska ${boardId} - nejvyÅ¡Å¡Ã­ dosaÅ¾enÃ© skÃ³re: ${Math.max(score, highScore)}`;

  // Aktualizace statistik
  updateGameStats(boardId, score);
}



// Funkce pro manuÃ¡lnÃ­ ukonÄenÃ­ kola, pokud nelze pouÅ¾Ã­t vÅ¡echny kostky
function manualEndRound() {
  const lock = locks[currentRound - 1];

  // Zkontrolujeme, zda jsou vÅ¡echny relevantnÃ­ buÅˆky pro tento zÃ¡mek vyplnÄ›ny
  const allCellsFilled = lock.coordinates.every(({ row, col }) => {
    const cell = document.getElementById(`cell-${row}-${col}`);
    return cell.classList.contains('clicked');
  });

  if (allCellsFilled) {
    // OznaÄÃ­me vÅ¡echny buÅˆky tohoto zÃ¡mku jako 'âœ”ï¸' v hernÃ­ desce
    lock.coordinates.forEach(({ row, col }) => {
      const cell = document.getElementById(`cell-${row}-${col}`);
      cell.classList.add('opened'); // PÅ™idÃ¡me tÅ™Ã­du 'opened' pro vizuÃ¡lnÃ­ oznaÄenÃ­
      cell.textContent = 'âœ”ï¸'; // ZmÄ›nÃ­me obsah buÅˆky na 'âœ”ï¸'
    });
    score += lockPoints[lock.name];
    confirm(`ZÃ¡mek ${lock.name} zÅ¯stÃ¡vÃ¡ otevÅ™enÃ½, poÄet zÃ­skanÃ½ch diamantÅ¯: ${lockPoints[lock.name]}.`);
  } else {
    confirm(`ZÃ¡mek ${lock.name} se uzamknul.`);
  }
  handleEndRound();
  // Aktualizujeme skÃ³re na obrazovce
  document.getElementById('score').innerText = `Deska ${boardId} - poÄet bodÅ¯: ${score}`;

  // Posun na dalÅ¡Ã­ kolo
  currentRound++;
  if (currentRound <= locks.length) {
    rollDice();       // ZahÃ¡jenÃ­ novÃ©ho kola s novÃ½m hodem
    startRound();     // PÅ™ipravÃ­ hracÃ­ desku na novÃ© kolo
  } else {
    calculateFinalScore();
    document.getElementById('score').innerText = `Deska ${boardId} - poÄet bodÅ¯: ${score}`;
	updateGameStats(boardId, score);
    confirm("Hra skonÄila!");
   
  }
}



// Funkce pro ukonÄenÃ­ kola, pokud jsou pouÅ¾ity vÅ¡echny kostky
function endRound() {
  // Zkontrolujeme, zda jsou vÅ¡echny relevantnÃ­ buÅˆky pro tento zÃ¡mek vyplnÄ›ny
  const lock = locks[currentRound - 1];
  const allCellsFilled = lock.coordinates.every(({ row, col }) => {
    const cell = document.getElementById(`cell-${row}-${col}`);
    return cell.classList.contains('clicked');
  });

  if (allCellsFilled) {
      
   // OznaÄÃ­me vÅ¡echny buÅˆky tohoto zÃ¡mku jako 'âœ”ï¸' v hernÃ­ desce
    lock.coordinates.forEach(({ row, col }) => {
      const cell = document.getElementById(`cell-${row}-${col}`);
      cell.classList.add('opened'); // PÅ™idÃ¡me tÅ™Ã­du 'opened' pro vizuÃ¡lnÃ­ oznaÄenÃ­
      cell.textContent = 'âœ”ï¸'; // ZmÄ›nÃ­me obsah buÅˆky na 'âœ”ï¸'
    });   
      
    score += lockPoints[lock.name];
    confirm (`ZÃ¡mek ${lock.name} zÅ¯stÃ¡vÃ¡ otevÅ™enÃ½, poÄet zÃ­skanÃ½ch diamantÅ¯: ${lockPoints[lock.name]}.`);
  } else {
    confirm (`ZÃ¡mek ${lock.name} se uzamknul.`);
  }

  handleEndRound();

  // Posun na dalÅ¡Ã­ kolo a novÃ½ hod kostkami
  currentRound++;
  
  if (currentRound <= locks.length) {
  	document.getElementById('score').innerText = `Deska ${boardId} - poÄet bodÅ¯: ${score}`;
    rollDice();
    startRound();
   
  } else {   
    calculateFinalScore();
   	document.getElementById('score').innerText = `Kolo ${currentLock.name}/12, Deska ${boardId} - poÄet bodÅ¯: ${score}`;
	updateGameStats(boardId, score);
    confirm("Hra skonÄila!");
  }
}



// MoÅ¾nost opakovanÃ©ho hodu
function reRollDice(rerollIndex) {
  if (selectedDice.length > 0) {    
    const diceElements = document.querySelectorAll('.die:not(.used).clicked');
   diceElements.forEach((die) => {
            die.classList.add('rolling');
            setTimeout(() => {
                const newRoll = Math.floor(Math.random() * 6) + 1; // NovÃ¡ hodnota od 1 do 6
                die.innerText = newRoll;
                die.classList.remove('clicked', 'rolling'); // Reset kliknutÃ­ a animace po hodu

      // Aktualizace pole dice pro tuto kostku
       const dieIndex = Array.from(document.querySelectorAll('.die')).indexOf(die);
                dice[dieIndex] = newRoll;
            }, 750); // ÄŒas pro animaci
        });

    // Reset pole selectedDice, aby obsahovalo pouze novÃ© hodnoty
    selectedDice = []; // TÃ­m zajistÃ­me, Å¾e se starÃ© hodnoty nepÅ™iÄÃ­tajÃ­

    // OznaÄenÃ­ tlaÄÃ­tka ReRoll jako pouÅ¾itÃ© a deaktivovanÃ©
    const button = document.getElementById(`reRoll${rerollIndex}`);
    button.classList.add('used');
    button.classList.add('disabled');
    button.onclick = null; // ZamezenÃ­ opÄ›tovnÃ©mu kliknutÃ­

    // Aktualizace tlaÄÃ­tek ReRoll
    updateReRollButtons();

    highlightPossibleCells();
  } else {
    confirm("Vyberte alespoÅˆ jednu kostku pro opakovanÃ½ hod.");
  }
}

// Funkce pro aktualizaci ReRoll tlaÄÃ­tek
function updateReRollButtons() {
  console.log('Updating ReRoll buttons');
  const reRollButtons = document.querySelectorAll('.reroll-button');

  // Kontrola, zda je nÄ›jakÃ½ Skimmer aktivnÃ­
  const isAnySkimmerActive = document.querySelectorAll('.skimmer.clicked').length > 0;

  reRollButtons.forEach(button => {
    if (isAnySkimmerActive || button.classList.contains('used')) {
      // Pokud je skimmer aktivnÃ­ nebo je tlaÄÃ­tko pouÅ¾itÃ©, deaktivujeme tlaÄÃ­tko
      button.classList.add('disabled');
      button.onclick = null; // ZamezenÃ­ opÄ›tovnÃ©mu kliknutÃ­
    } else {
      // Pokud Å¾Ã¡dnÃ½ skimmer nenÃ­ aktivnÃ­ a tlaÄÃ­tko nenÃ­ pouÅ¾itÃ©, aktivujeme tlaÄÃ­tko
      button.classList.remove('disabled');
      button.onclick = function() {
        reRollDice(parseInt(button.id.replace('reRoll', '')));
      };
    }
  });
}



// Zobrazi nabidku pÅ™i kliknutÃ­ na Skimmer (uloÅ¾enÃ­ hodnoty do Skimmeru nebo pouÅ¾itÃ­ Skimmeru jako virtuÃ¡lnÃ­ kostky)
function showSkimmerOptions(index) {
  const skimmerName = `Å perhÃ¡k ${index + 1}`;
  const option = prompt(`Vybrali jste ${skimmerName}\nVyberte moÅ¾nost:\n(zadejte ÄÃ­slo volby)\n1) UloÅ¾it hodnotu oznaÄenÃ½ch kostek \n2) PouÅ¾Ã­t jako dalÅ¡Ã­ virtuÃ¡lnÃ­ kostku\nâš ï¸ Tato akce je nevratnÃ¡ âš ï¸`);
  if (option === "1") {
    addDiceToSkimmer(index);
  } else if (option === "2") {
    useSkimmerAsDie(index);
  } else {
    confirm ("NeplatnÃ¡ volba. Zkuste to znovu.");
  }
}

// PÅ™idÃ¡nÃ­ vybranÃ½ch kostek do skimmeru
function addDiceToSkimmer(index) {
  if (document.querySelectorAll('.skimmer')[index].classList.contains('disabled')) {
    confirm ("Tento Å perhÃ¡k jiÅ¾ nelze pouÅ¾Ã­t.");
    return;
  }  
  if (anySkimmerAsDie) {
    confirm("Jeden ze Å perhÃ¡kÅ¯ je jiÅ¾ pouÅ¾it jako virtuÃ¡lnÃ­ kostka. Nelze pÅ™idÃ¡vat hodnoty do ostatnÃ­ch Å perhÃ¡kÅ¯.");
    return;
  }
  if (selectedDice.length > 0) {
    // SouÄet hodnot vybranÃ½ch kostek
    const diceSum = selectedDice.reduce((a, b) => a + b, 0);
    const remainingCapacity = 20 - skimmers[index];

    // Kontrola, zda vybranÃ© kostky nepÅ™esahujÃ­ zbÃ½vajÃ­cÃ­ kapacitu skimmeru
    if (diceSum > remainingCapacity) {
      confirm (`Nelze pÅ™idat: hodnota kostek [${diceSum}] pÅ™ekraÄuje zbÃ½vajÃ­cÃ­ kapacitu [${remainingCapacity}] Å¡perhÃ¡ku.`);
    } else {
      // PÅ™idÃ¡nÃ­ kostek do skimmeru a aktualizace UI
      skimmers[index] += diceSum;
      document.getElementById(`skimmer${index + 1}`).innerText = skimmers[index];

      // OznaÄenÃ­ vybranÃ½ch kostek jako pouÅ¾itÃ½ch
      document.querySelectorAll('.die.clicked').forEach(die => {
        die.classList.add('used');
        die.classList.remove('clicked');
      });

      selectedDice = []; // Reset vybranÃ½ch kostek po pÅ™enosu
      highlightPossibleCells(); // Aktualizace zvÃ½raznÄ›nÃ­ po pÅ™idÃ¡nÃ­ do skimmeru
      // Zkontrolovat, zda byly pouÅ¾ity vÅ¡echny kostky
      checkAllDiceUsed();
    }
  } else {
    confirm ("Vyberte alespoÅˆ jednu kostku pro pÅ™esun do Å perhÃ¡ku.");
  }
}

// PouÅ¾itÃ­ Skimmeru jako virtuÃ¡lnÃ­ kostky
function useSkimmerAsDie(index) {
  if (skimmers[index] > 0) {
    selectedDice.push(skimmers[index]);
    document.querySelectorAll('.skimmer')[index].classList.add('clicked');
    document.querySelectorAll('.skimmer')[index].onclick = null; // ZamezenÃ­ opÄ›tovnÃ©mu pouÅ¾itÃ­ skimmeru
    anySkimmerAsDie = true; // NastavenÃ­ stavu, Å¾e je jeden ze SkimmerÅ¯ pouÅ¾it jako kostka
    confirm (`Å perhÃ¡k ${index + 1} byl pouÅ¾it jako virtuÃ¡lnÃ­ kostka s hodnotou [${skimmers[index]}].\nğŸ’¡ Vyber pole na hracÃ­ desce,\nmÅ¯Å¾eÅ¡ kombinovat s jinÃ½mi kostkami.`);
    updateReRollButtons();
    highlightPossibleCells(); // Aktualizace zvÃ½raznÄ›nÃ­ po pouÅ¾itÃ­ skimmeru
  } else {
    confirm ("Hodnota Å perhÃ¡ku musÃ­ bÃ½t minimÃ¡lnÄ› 1.");
  }
}

// Funkce pro resetovÃ¡nÃ­ stavu, kdyÅ¾ je skimmer pouÅ¾it jako kostka a jeho hodnota je umÃ­stÄ›na na hracÃ­ desku
function resetSkimmerState() {
  anySkimmerAsDie = false; // Reset stavu, Å¾e Å¾Ã¡dnÃ½ Skimmer nenÃ­ pouÅ¾it jako kostka
  document.querySelectorAll('.skimmer').forEach(skimmer => {
    skimmer.classList.remove('clicked'); // Odstranit tÅ™Ã­du clicked ze vÅ¡ech SkimmerÅ¯
    skimmer.onclick = function() { showSkimmerOptions(Array.from(document.querySelectorAll('.skimmer')).indexOf(skimmer)); }; // Obnovit moÅ¾nost kliknutÃ­ na Skimmer
  });
}

// funkce pro zvÃ½raznÄ›nÃ­ kombinacÃ­ hodnot aktivnÃ­ch kostek (vÄetnÄ› virtuÃ¡lnÃ­ch) na hracÃ­ desce
function highlightPossibleCells() {
  const currentLock = locks[currentRound - 1]; // ZÃ­skÃ¡nÃ­ aktuÃ¡lnÃ­ho zÃ¡mku
  const lockCoordinates = new Set(
    currentLock.coordinates.map(({ row, col }) => `cell-${row}-${col}`)
  );

  // VytvoÅ™enÃ­ seznamu aktivnÃ­ch kostek (vÄetnÄ› virtuÃ¡lnÃ­ kostky, pokud existuje)
  const activeDice = virtualDice !== null ? [virtualDice] : selectedDice;
  console.log("AktivnÃ­ hodnoty pro zvÃ½raznÄ›nÃ­:", activeDice);

  // Pokud nejsou Å¾Ã¡dnÃ© aktivnÃ­ kostky, odstranÃ­me zvÃ½raznÄ›nÃ­ a obnovÃ­me zÃ¡mky
  if (activeDice.length === 0) {
    document.querySelectorAll('.cell').forEach(cell => {
      if (!lockCoordinates.has(cell.id)) {
        cell.classList.remove('highlight', 'highlight-empty');
      } else {
        cell.classList.remove('highlight');
        cell.classList.add('highlight-empty');
      }
    });
    console.log("Å½Ã¡dnÃ© aktivnÃ­ kostky, odstranÄ›no vÅ¡echno zvÃ½raznÄ›nÃ­ kromÄ› zÃ¡mkÅ¯.");
    return;
  }

  // GenerovÃ¡nÃ­ vÅ¡ech moÅ¾nÃ½ch souÄtÅ¯ a rozdÃ­lÅ¯ z vybranÃ½ch kostek
  const possibleSumsAndDiffs = generatePossibleSumsAndDiffs(activeDice);
  console.log("MoÅ¾nÃ© souÄty a rozdÃ­ly:", Array.from(possibleSumsAndDiffs));

  // Kontrola, zda se v souÄtech vyskytujÃ­ lichÃ© a sudÃ© vÃ½sledky pro jednu hodnotu
  const hasSingleOdd = activeDice.length === 1 && activeDice[0] % 2 !== 0;
  const hasSingleEven = activeDice.length === 1 && activeDice[0] % 2 === 0;
  console.log("Obsahuje jednu lichou hodnotu:", hasSingleOdd);
  console.log("Obsahuje jednu sudou hodnotu:", hasSingleEven);

  document.querySelectorAll('.cell').forEach(cell => {
    const cellValue = cell.innerText.trim();
    const cellId = cell.id;

    // PodmÃ­nky pro speciÃ¡lnÃ­ hodnoty
    const isDoubleSame = cellValue === 'D' && activeDice.length === 2 && activeDice[0] === activeDice[1];

    // Kontrola, zda buÅˆka splÅˆuje nÄ›kterou z podmÃ­nek pro oznaÄenÃ­ zelenou barvou
    if (
      (cellValue === 'L' && hasSingleOdd) ||
      (cellValue === 'S' && hasSingleEven) ||
      isDoubleSame ||
      possibleSumsAndDiffs.has(parseInt(cellValue))
    ) {
      cell.classList.add('highlight'); // NastavÃ­ zelenou barvu
      console.log(`ZvÃ½raznÄ›no pole: ${cellId} s hodnotou ${cellValue}`);
      cell.classList.remove('highlight-empty');
    } else if (lockCoordinates.has(cellId)) {
      // Pokud buÅˆka patÅ™Ã­ k aktuÃ¡lnÃ­mu zÃ¡mku, obnovÃ­me Å¾lutou barvu
      cell.classList.remove('highlight'); // OdstranÃ­ zelenou barvu
      cell.classList.add('highlight-empty'); // NastavÃ­ zpÄ›t na Å¾lutou
    } else {
      // Pro ostatnÃ­ buÅˆky odstranÃ­me jakÃ©koli zvÃ½raznÄ›nÃ­
      cell.classList.remove('highlight', 'highlight-empty');
    }
  });
}

// PomocnÃ¡ funkce pro generovÃ¡nÃ­ vÅ¡ech moÅ¾nÃ½ch souÄtÅ¯ a rozdÃ­lÅ¯ z vybranÃ½ch kostek
function generatePossibleSumsAndDiffs(diceArray) {
  const results = new Set();
  
  function calculateCombinations(dice, currentSum) {
    if (dice.length === 0) {
      results.add(currentSum); // PÅ™idÃ¡me aktuÃ¡lnÃ­ souÄet do vÃ½sledkÅ¯
      return;
    }

    for (let i = 0; i < dice.length; i++) {
      const remainingDice = dice.slice(0, i).concat(dice.slice(i + 1));
      calculateCombinations(remainingDice, currentSum + dice[i]);
      calculateCombinations(remainingDice, currentSum - dice[i]);
    }
  }

  calculateCombinations(diceArray, 0); // SpustÃ­me vÃ½poÄet kombinacÃ­ se souÄtem 0
  return results;
}



  // PÅ™epnutÃ­ stavu kostky (oznaÄenÃ­/odznaÄenÃ­) a pÅ™idÃ¡nÃ­/odebrÃ¡nÃ­ jejÃ­ hodnoty do/z vybranÃ½ch kostek
  function toggleDie(index) {
    const die = document.querySelectorAll('.die')[index];
    const dieValue = dice[index];

    	if (!die.classList.contains('used')) { // Kostku lze vybrat, pouze pokud nebyla pouÅ¾ita
      die.classList.toggle('clicked');

      if (die.classList.contains('clicked')) {
        selectedDice.push(dieValue); // PÅ™idat hodnotu kostky do vybranÃ½ch
      } else {
      selectedDice = selectedDice.filter((value, idx) => idx !== selectedDice.indexOf(dieValue));
      }
    console.log("AktuÃ¡lnÃ­ vybranÃ© kostky:", selectedDice); // Pro kontrolu stavu
	  highlightPossibleCells(); // Aktualizace zvÃ½raznÄ›nÃ­ polÃ­ po zmÄ›nÄ› vÃ½bÄ›ru kostek
    }
  }


// Funkce pro oznaÄenÃ­ polÃ­Äka na desce podle pravidel pro 'L', 'S' a 'D'
function markCell(row, col, cellValue) {
  const cell = document.getElementById(`cell-${row}-${col}`);
console.log(`--- markCell called ---`);
  console.log(`VybranÃ© polÃ­Äko Å™Ã¡dek: ${row}, sloupec: ${col}, hodnota: ${cellValue}`);
  
  // PodmÃ­nky pro jednotlivÃ© kombinace kostek
  const isSingleOdd = selectedDice.length === 1 && selectedDice[0] % 2 !== 0;
  const isSingleEven = selectedDice.length === 1 && selectedDice[0] % 2 === 0;
  const isDoubleSame = selectedDice.length === 2 && selectedDice[0] === selectedDice[1];
  	
	

  // Funkce pro generovÃ¡nÃ­ vÅ¡ech moÅ¾nÃ½ch souÄtÅ¯ a rozdÃ­lÅ¯ z vybranÃ½ch kostek
  function generatePossibleSumsAndDiffs(diceArray) {
    const results = new Set();
    
    // RekurzivnÃ­ funkce pro generovÃ¡nÃ­ vÅ¡ech kombinacÃ­ sÄÃ­tÃ¡nÃ­ a odeÄÃ­tÃ¡nÃ­
    function calculateCombinations(dice, currentSum, currentDiff) {
      if (dice.length === 0) {
        results.add(currentSum); // PÅ™idÃ¡me souÄet
        results.add(Math.abs(currentDiff)); // PÅ™idÃ¡me rozdÃ­l
        return;
      }

      // Pro kaÅ¾dou kostku, rozhodneme, zda ji pÅ™iÄteme nebo odeÄteme
      for (let i = 0; i < dice.length; i++) {
        const remainingDice = dice.slice(0, i).concat(dice.slice(i + 1));

        // PÅ™edstavuje moÅ¾nost pÅ™iÄÃ­st aktuÃ¡lnÃ­ kostku
        calculateCombinations(remainingDice, currentSum + dice[i], currentDiff + dice[i]);
        
        // PÅ™edstavuje moÅ¾nost odeÄÃ­st aktuÃ¡lnÃ­ kostku
        calculateCombinations(remainingDice, currentSum - dice[i], currentDiff - dice[i]);
      }
    }

    // ZaÄneme rekurzivnÃ­ vÃ½poÄty pro vÅ¡echny kostky
    calculateCombinations(diceArray, 0, 0);

    return results;
  }

  // Vygeneruj vÅ¡echny moÅ¾nÃ© souÄty a rozdÃ­ly
  const possibleSumsAndDiffs = generatePossibleSumsAndDiffs(selectedDice);

  // Zkontroluj, jestli hodnota buÅˆky odpovÃ­dÃ¡ nÄ›kterÃ©mu z moÅ¾nÃ½ch souÄtÅ¯ nebo rozdÃ­lÅ¯
  if (
    (cellValue === 'L' && isSingleOdd) ||
    (cellValue === 'S' && isSingleEven) ||
    (cellValue === 'D' && isDoubleSame) ||
    possibleSumsAndDiffs.has(parseInt(cellValue)) // Zkontroluj, jestli je hodnota v seznamu moÅ¾nÃ½ch souÄtÅ¯ a rozdÃ­lÅ¯
  ) {
    cell.classList.add('clicked'); // OznaÄenÃ­ polÃ­Äka jako "kliknutÃ©"
	document.querySelectorAll('.cell').forEach(cell => {
		cell.classList.remove('highlight'); // OdstranÃ­me starÃ© zvÃ½raznÄ›nÃ­
	  });
    // OznaÄenÃ­ vybranÃ½ch kostek jako pouÅ¾itÃ½ch a odstranÄ›nÃ­ jejich vÃ½bÄ›ru
    document.querySelectorAll('.die.clicked').forEach(die => {
      die.classList.add('used');
      die.classList.remove('clicked');
    });
	// OznaÄenÃ­ vybranÃ½ch SkimmerÅ¯ jako pouÅ¾itÃ½ch a odstranÄ›nÃ­ jejich vÃ½bÄ›ru
	document.querySelectorAll('.skimmer.clicked').forEach(skimmer => {
      skimmer.classList.add('used');
      skimmer.classList.add('disabled');
      skimmer.classList.remove('clicked');
    });
    
    selectedDice = []; // Reset vybranÃ½ch kostek po pouÅ¾itÃ­

    // Zkontrolovat, zda byly pouÅ¾ity vÅ¡echny kostky
    checkAllDiceUsed();
    highlightPossibleCells();
    updateReRollButtons();
    resetSkimmerState();
  } else {
    confirm ("Hodnota kostek neodpovÃ­dÃ¡ poÅ¾adavkÅ¯m na toto pole.");
  }
}




	// Inicializace hry
	function initGame() {
	  selectBoard(); // umoÅ¾nÃ­ vÃ½bÄ›r desky
	  createBoard(); // vytvoÅ™Ã­ vybranou desku
	  startGame();   // zahÃ¡jÃ­ hru s vybranou deskou
	}


initGame();



</script>
</body>
</html>
